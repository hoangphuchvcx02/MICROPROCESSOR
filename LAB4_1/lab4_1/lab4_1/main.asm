.ORG 0x00
RJMP MAIN
.ORG 0x40

MAIN: 
	LDI R21,0xFF
	OUT DDRA,R21 ;Port A là port xu?t
	RCALL USART_INIT


AGAIN:
	RCALL USART_REC 
	OUT PORTA,R18
	RCALL USART_TRANS

RJMP AGAIN

USART_INIT:
	LDI R16,(1<<RXEN0) | (1<<TXEN0) ;cho phép thu / phát
	STS UCSR0B,R16
	LDI R16,(1<<UCSZ01)|(1<<UCSZ00) ;8-bit data
	STS UCSR0C,R16 ;không parity, 1 stop bit
	LDI R16,0x00
	STS UBRR0H,R16
	LDI R16,51 ;9600 baud rate fosc=8MHz
	STS UBRR0L,R16
	RET

// THU KÝ T? (THU VÀO CPU)
USART_REC: 
	LDS R17,UCSR0A
	SBRS R17,RXC0 ;c? RXC0=1: thu xong
	RJMP USART_REC ;ch? c? RXC0=1
	LDS R18,UDR0
	RET

// PHÁT L?I HERCULES
USART_TRANS: 
	LDS R17,UCSR0A
	SBRS R17,UDRE0 ;c? UDRE0=1: b? ??m phát tr?ng
	RJMP USART_TRANS ;ch? c? UDRE0=1
	STS UDR0,R18 ;phát ký t?
	RET